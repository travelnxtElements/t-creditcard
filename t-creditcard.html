<!-- We are still creating this components -->
<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../t-address/t-address.html" />
<link rel="import" href="t-cc-cvc-input.html" />
<link rel="import" href="t-cc-expiration-input.html" />
<link rel="import" href="t-cc-input.html" />
<link rel="import" href="t-email-input.html" />
<link rel="import" href="t-phone-input.html" />
<link rel="import" href="t-zip-input.html" />
<!--
    `<t-creditcard>` is a polymer component that generates a playground for interacting with components.

    <div class="demo-canvas">
        
    </div>

    <t-creditcard metadata-source="metadata url" property-source="property url" component="component name">
        
        <div class="component">
            
            'component template'
        </div>
    </t-creditcard>     
-->
<dom-module id="t-creditcard">
    <template>
    <style>
    :host {
        width: 100%;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    /* }
    :host,t-cc-cvc-input{ */
        overflow: hidden;
    }
    .vertical-margin {
        margin-bottom: 10px;
    }
    
    .horizontal-margin {
        padding-right: 5px;
    }
    .section{
        padding: 0 10px;
    }
    </style>
        <div class="layout vertical section">
            <div class="vertical-margin">
                <t-cc-input label="Card number" card-type="{{cardType}}"  id="number" name="number" error-message="You missed this." required auto-validate></t-cc-input>
            </div>
            <div class="vertical-margin">
                <t-input auto-validate label="Name on card" name="nameOnCard"  id="nameOnCard" error-message="You missed this." required></t-input>
            </div>
            <div class="vertical-margin layout horizontal">
                <div class="horizontal-margin flex">
                    <t-cc-expiration-input name="expiryDate" id="expiryDate" error-message="You missed this." required auto-validate></t-cc-expiration-input>
                </div>
                <div class="flex">
                    <t-cc-cvc-input name="securityCode" id="securityCode" card-type="[[cardType]]" error-message="You missed this." required auto-validate></t-cc-cvc-input>
                </div>
            </div>

        </div>
    </template>
</dom-module>
<script>
Polymer({

    is: 't-creditcard',

    properties: {
        /**
         * Response object of the form.
         */
        response: {
            type: Object,
            value: function() {
                return {};
            }
        },
        
        /**
         * NodeList of all fields present in the form.
         */
        fields: {
            type: Array,
            value: function() {
                return [];
           }
        }

    },
    
    validate: function() {
        var isValid = true;
        this.fields = this.querySelectorAll('[name]')
        for(a=0; a <this.fields.length;a++){
            if (this.fields[a].validate() != undefined){
                isValid = isValid && this.fields[a].validate();
            }
        }
        return isValid;
    },

    getInfo: function() {
        var date = new Date();
        date = date.getFullYear().toString();
        var expiryMonth = this.$.expiryDate._computeMonth(this.$.expiryDate.value);
        var expiryYear = this.$.expiryDate._computeYear(this.$.expiryDate.value);
 
        expiryYear = date.substring(0, 2) + expiryYear;

        var info = {
            "number": this.$.number.formattedValue,
            "nameOnCard": this.$.nameOnCard.value,
            "securityCode": this.$.securityCode.value,
            "expiryMonth": expiryMonth,
            "expiryYear": expiryYear,
            "cardMake":"CreditCard" //TODO: remove hardcoded
        }
        return info;
    }



})
</script>
